(this["webpackJsonpjaxcore-say-full-example"]=this["webpackJsonpjaxcore-say-full-example"]||[]).push([[0],{1:function(e,t,a){e.exports=a(26)},15:function(e,t,a){"use strict";(function(e){var n=a(3),i=a(4),o=a(17),s=a(16),r=a(5),l=a(18),u=a(0),c=a.n(u),h=a(1),p=a.n(h);e.Say=p.a,p.a.addProfile({"Custom ESpeak Voice":{name:"Custom ESpeak Voice",engine:"espeak",default:{amplitude:100,wordgap:1,pitch:40,speed:150,variant:"m7"},high:{pitch:55},low:{pitch:5},slow:{speed:100},fast:{speed:200}}}),p.a.addProfile({"Custom SAM Voice":{name:"Custom SAM Voice",engine:"sam",default:{speed:82,pitch:72,throat:110,mouth:105},high:{pitch:50},low:{pitch:100},slow:{speed:130},fast:{speed:60}}}),p.a.setWorkers({espeak:"webworkers/espeak-all-worker.js",sam:"webworkers/sam-worker.js"});var d=new p.a({language:"en"});e.sayVoice=d;var f=function(t){function a(){var t;return Object(n.a)(this,a),(t=Object(o.a)(this,Object(s.a)(a).call(this))).canvasRef=c.a.createRef(),t.state={profile:"Jack",speed:"default",pitch:"default",text:"",language:"en/en",languageEnabled:!0,spoken:[{profile:"Jack",speed:"default",pitch:"default",text:"Hello World",language:"en/en"}],spokenIndex:null,code:"",viewCode:!1},e.app=Object(r.a)(t),t}return Object(l.a)(a,t),Object(i.a)(a,[{key:"componentDidMount",value:function(){this.updateCode(),this.monoScope=new h.MonauralScope(this.canvasRef.current),d.setVisualizer(this.monoScope)}},{key:"render",value:function(){var e=this;return c.a.createElement("div",null,c.a.createElement("h2",null,"Jaxcore Say: Full Example"),c.a.createElement("div",null,c.a.createElement("canvas",{ref:this.canvasRef,width:"300",height:"300"})),c.a.createElement("div",null,"Voice: ",this.renderProfileSelect()),c.a.createElement("div",null,"Speed: ",this.renderSpeedSelect()),c.a.createElement("div",null,"Pitch: ",this.renderPitchSelect()),c.a.createElement("div",null,"Language: ",this.renderLanguageSelect()),c.a.createElement("div",null,c.a.createElement("input",{size:"40",placeholder:"Type something then press Enter",onKeyUp:function(t){return e.onKeyUp(t)},onChange:function(t){return e.onChangeText(t)},value:this.state.text}),c.a.createElement("button",{onClick:function(t){return e.sayText(!0)}},"Say")),c.a.createElement("ul",null,this.state.spoken.map((function(t,a){return c.a.createElement("li",{key:a},c.a.createElement("a",{href:"/",onClick:function(t){return e.clickSpoken(t,a)}},t.text)," (",t.profile," ",t.speed," ",t.pitch,")")}))),c.a.createElement("div",null,c.a.createElement("button",{onClick:function(t){return e.clear()}},"Clear")),c.a.createElement("br",null),c.a.createElement("div",null,c.a.createElement("button",{onClick:function(t){return e.setState({viewCode:!e.state.viewCode})}},this.state.viewCode?"Hide Code":"View Code")),this.renderCode())}},{key:"renderCode",value:function(){if(this.state.viewCode)return c.a.createElement("pre",null,this.state.code)}},{key:"clear",value:function(e){this.setState({spoken:[]})}},{key:"clickSpoken",value:function(e,t){var a=this;e.preventDefault();var n=this.state.spoken[t];this.sayIndex(t);var i="espeak"===p.a.profiles[n.profile].engine;this.setState({text:n.text,profile:n.profile,speed:n.speed,pitch:n.pitch,language:n.language,languageEnabled:i},(function(){a.updateCode(t)}))}},{key:"onKeyUp",value:function(e){if(13===e.keyCode)return e.preventDefault(),void this.sayText();this.updateCode(),console.log("keydown",e)}},{key:"renderLanguageSelect",value:function(){var e=this;if(this.state.languageEnabled){var t=[];for(var a in p.a.languageIds)t.push(c.a.createElement("option",{key:a,value:a},p.a.languageIds[a]));return c.a.createElement("select",{onChange:function(t){return e.selectLanguage(t)},value:this.state.language},t)}return"none"}},{key:"selectLanguage",value:function(e){var t=this,a=e.target.options[e.target.selectedIndex].value;this.setState({language:a},(function(){t.updateCode()}))}},{key:"updateCode",value:function(e,t){"undefined"===typeof e&&(e=null);var a=this.generateCode(e);this.setState({code:a},t)}},{key:"renderSpeedSelect",value:function(){var e=this;return c.a.createElement("select",{onChange:function(t){return e.selectSpeed(t)},value:this.state.speed},c.a.createElement("option",{value:"default"},"default"),c.a.createElement("option",{value:"fast"},"fast"),c.a.createElement("option",{value:"slow"},"slow"))}},{key:"renderPitchSelect",value:function(){var e=this;return c.a.createElement("select",{onChange:function(t){return e.selectPitch(t)},value:this.state.pitch},c.a.createElement("option",{value:"default"},"default"),c.a.createElement("option",{value:"low"},"low"),c.a.createElement("option",{value:"high"},"high"))}},{key:"selectPitch",value:function(e){var t=this,a=e.target.options[e.target.selectedIndex].value;this.setState({pitch:a},(function(){t.updateCode()}))}},{key:"selectSpeed",value:function(e){var t=this,a=e.target.options[e.target.selectedIndex].value;this.setState({speed:a},(function(){t.updateCode()}))}},{key:"renderProfileSelect",value:function(){var e=this,t=[];for(var a in d.profiles)"espeak"===p.a.profiles[a].engine&&t.push(c.a.createElement("option",{key:a,value:a},a));var n=[];for(var i in d.profiles)"sam"===p.a.profiles[i].engine&&n.push(c.a.createElement("option",{key:i,value:i},i));return c.a.createElement("select",{onChange:function(t){return e.selectProfile(t)},value:this.state.profile},c.a.createElement("optgroup",{label:"- ESpeak Voices -"},t),c.a.createElement("optgroup",{label:"- SAM Voices -"},n))}},{key:"selectProfile",value:function(e){var t=this,a=e.target.options[e.target.selectedIndex].value,n="espeak"===p.a.profiles[a].engine;this.setState({profile:a,languageEnabled:n},(function(){t.updateCode()}))}},{key:"sayText",value:function(e){var t=this,a=this.state.text;if(0!==a.length){var n=this.state.profile,i=this.state.speed,o=this.state.pitch,s=this.state.language,r={text:a,speed:i,pitch:o,language:s,profile:n},l=this.state.spoken[this.state.spoken.length-1],u=!1;l&&l.text===a&&l.speed===i&&l.pitch===o&&l.language===s&&l.profile===n&&(u=!0);var c,h=this.state.spoken;u?c=this.state.spoken.length-1:(c=this.state.spoken.length,h.push(r)),e||(a=""),this.setState({spoken:h,spokenIndex:c,text:a},(function(){t.updateCode(),t.sayIndex(c)}))}}},{key:"sayIndex",value:function(e){var t=this,a=this.state.spoken[e],n=[];p.a.profiles[a.profile].phoneticName&&n.push([a.profile,p.a.profiles[a.profile].phoneticName]);var i={profile:a.profile,language:a.language,replacements:n};"default"!==a.speed&&(i[a.speed]=!0),"default"!==a.pitch&&(i[a.pitch]=!0),this.colors={Jack:"255,0,0",Pris:"255,255,0",Roy:"0,255,0",Xenu:"255,0,255",Cylon:"150,75,0",Borg:"128,128,128",Leon:"128,0,0",Rachel:"128,128,0",Zhora:"0,128,0",Sam:"0,128,128",Elf:"128,0,128",Robo:"255,0,128",Granny:"255,128,0"};var o=this.colors[a.profile]||"0,0,255";this.monoScope.theme.strokeColor="rgb("+o+")",this.monoScope.theme.clipColor="black",this.monoScope.theme.fillColor="rgba("+o+",0.2)",this.monoScope.theme.dotColor="rgb("+o+")",console.log("Say: started"),this.setState({isSpeaking:!0},(function(){d.say(a.text,i).then((function(){console.log("Say: stopped"),t.setState({isSpeaking:!1})}))}))}},{key:"onChangeText",value:function(e){var t=this;this.setState({text:e.target.value},(function(){t.updateCode()}))}},{key:"generateCode",value:function(e){var t;t=null===e||0===this.state.spoken.length?this.state:this.state.spoken[e];var a=p.a.getLanguageId(t.language),n="";"Custom ESpeak Voice"===t.profile?n='Say.addProfile({\n\t"Custom ESpeak Voice": {\n\t\t"name": "Custom ESpeak Voice",\n\t\t"engine": "espeak",\n\t\t"default": {\n\t\t\tamplitude: 100,\n\t\t\twordgap: 1,\n\t\t\tpitch: 40,\n\t\t\tspeed: 150,\n\t\t\tvariant: \'m7\'\n\t\t},\n\t\t"high": {\n\t\t\tpitch: 55\n\t\t},\n\t\t"low": {\n\t\t\tpitch: 5\n\t\t},\n\t\t"slow": {\n\t\t\tspeed: 100\n\t\t},\n\t\t"fast": {\n\t\t\tspeed: 200\n\t\t}\n\t}\n});\n':"Custom SAM Voice"===t.profile&&(n='Say.addProfile({\n\t"Custom SAM Voice": {\n\t\t"name": "Custom SAM Voice",\n\t\t"engine": "sam",\n\t\t"default": {\n\t\t\tspeed: 82,\n\t\t\tpitch: 72,\n\t\t\tthroat: 110,\n\t\t\tmouth: 105\n\t\t},\n\t\t"high": {\n\t\t\tpitch: 50\n\t\t},\n\t\t"low": {\n\t\t\tpitch: 100\n\t\t},\n\t\t"slow": {\n\t\t\tspeed: 130\n\t\t},\n\t\t"fast": {\n\t\t\tspeed: 60\n\t\t}\n\t}\n});\n');var i="";"espeak"===p.a.profiles[t.profile].engine&&(i='\tlanguage: "'+t.language+'"\n');var o='import Speak from "jaxcore-speak";\n'+("en/en"===a?"Say.setWorkers({\n\t'espeak': 'webworkers/espeak-en-worker.js',\n\t'sam': 'webworkers/sam-worker.js'\n});\n":"Say.setWorkers({\n\t'espeak': 'webworkers/espeak-all-worker.js',\n\t'sam': 'webworkers/sam-worker.js'\n});\n")+n+'var voice = new Say({\n\tprofile: "'+t.profile+'",\n'+i+"});\n";if("default"===t.speed&&"default"===t.pitch)o+='voice.say("'+t.text+'");';else{var s=[];"default"!==t.speed&&s.push("  "+t.speed+": true"),"default"!==t.pitch&&s.push("  "+t.pitch+": true"),o+='voice.say("'+t.text+'", {\n'+s.join(",\n")+"\n});"}return o}}]),a}(u.Component);t.a=f}).call(this,a(25))},19:function(e,t,a){e.exports=a(34)},24:function(e,t,a){},26:function(e,t,a){var n=a(6),i=a(7),o=a(8),s=a(9),r=a(10),u=a(11),c=a(33),h=a(30),p=a(31),d=a(32);function f(){var e;if(window.AudioContext)e=new window.AudioContext;else{if(!window.webkitAudioContext)throw new Error("no AudioContext");console.log("creating webkitAudioContext"),e=new window.webkitAudioContext}return e}var g=function(e){"use strict";function t(e){var a;for(var i in n(this,t),e||(e={}),(a=o(this,s(t).call(this))).lang=null,a.profiles={},a.defaultProfile=null,p)a.addProfile(p[i]);return e.profile?a.setProfile(e.profile):a.setProfile("Jack"),"espeak"===a.profile.engine&&e.language&&a.setLanguage(e.language),a.lang||a.setLanguage("en_us"),e.visualizer&&a.setVisualizer(e.visualizer),a}return r(t,e),i(t,[{key:"setVisualizer",value:function(e){this.visualizer=e}},{key:"setLanguage",value:function(e){this.lang=t.getLanguageId(e)}},{key:"processOptions",value:function(e,a){a||(a={});var n=a.profile?a.profile:this.defaultProfile,i=this.profiles[n].default,o=Object.assign({},i);return a.slow&&(o.speed=this.profiles[n].slow.speed),a.fast&&(o.speed=this.profiles[n].fast.speed),a.low&&(o.pitch=this.profiles[n].low.pitch),a.high&&(o.pitch=this.profiles[n].high.pitch),"pitch"in a&&(o.pitch=a.pitch),"speed"in a&&(o.speed=a.speed),"wordgap"in a&&(o.wordgap=a.wordgap),"amplitude"in a&&(o.amplitude=a.amplitude),a.language?o.voice=t.getLanguageId(a.language):o.voice=this.lang,a.delay&&(o.delay=a.delay),a.replacements&&(o.replacementText=function(e,t){if("object"===typeof t){var a=function(a){var n="(?<=\\s|^)("+t[a]+")(?=\\s|$)";new RegExp(n,"i").test(e)&&(e=e.replace(new RegExp(n,"gi"),(function(e,t){return a})))};for(var n in t)a(n);return e}}(e,a.replacements)),o}},{key:"say",value:function(e,t){var a=this;return t=t||{},this.visualizer?new Promise((function(n){a.getWorkerAudioData(e,t,(function(e,t){a.visualizer.loadAudioData(e,t,n)}))})):new Promise((function(n){a.getWorkerAudioData(e,t,(function(e,a){if("Borg"===t.profile){var i=a.buffer,o=e.createGain();o.gain.setValueAtTime(1,0),o.gain.setValueAtTime(1,i.duration-.5),o.gain.linearRampToValueAtTime(1e-4,i.duration-.2),a.connect(o),o.connect(e.destination);var s=!1;setTimeout((function(){s||(s=!0,a.stop(),e.close(),n())}),1e3*i.duration-200),a.onended=function(){s||(s=!0,e.close(),n())},a.start(0)}else a.connect(e.destination),a.onended=function(){e.close(),n()},a.start(0)}))}))}},{key:"getWorkerAudioData",value:function(e,a,n){e=e.toLowerCase(),a||(a={});var i=a.profile||this.defaultProfile;if("Borg"===i)this.borgGetAudioData(e,a,n);else{i||(i="Jack");var o=this.profiles[i];if(!o)throw new Error("no profile: "+i);var s,r=o.engine;if("sam"===r)s=t.workers.sam;else if("espeak"===r)if("string"===typeof t.workers.espeak)s=t.workers.espeak;else if(t.workers.espeak.length){var u=a.language;u.startsWith("en-")&&(u="en/"+l);for(var c=0;c<t.workers.espeak.length;c++)if(t.workers.espeak[c].language===u){s=t.workers.espeak[c].path;break}}if(!s)throw new Error("no worker path for this language");var h=new Worker(s);h.addEventListener("message",(function(e){if(console.log("received from worker:",e.data),e.data.rawdata){var t=f();if(!t||!t.createBufferSource)return void console.log("no audioContext 2");var i=t.createBufferSource(),o=e.data.rawdata;if(a.rawAudioData)n(o);else if("sam"===r){for(var s=t.createBuffer(1,o.length,22050),l=s.getChannelData(0),u=0;u<o.length;u++)l[u]=o[u];i.buffer=s,console.log("returning sam"),n(t,i)}else t.decodeAudioData(o,(function(e){i.buffer=e,n(t,i)}),(function(e){console.log("error",e)}))}}),!1);var p=this.processOptions(e,a);h.postMessage({cmd:"speak",text:e,options:p})}}},{key:"addProfile",value:function(e){["high","low","fast","slow"].forEach((function(t){if("default"!==t&&"name"!==t){var a=Object.assign({},e.default);for(var n in e[t])a[n]=e[t][n];e[t]=a}})),this.profiles[e.name]=e}},{key:"setProfile",value:function(e){return this.defaultProfile=e,this.profile=p[e],this}},{key:"borgGetAudioData",value:function(e,t,a){var n=this;e+="....";var i=[],o=t&&t.language?t.language:this.lang,s=f();i.push((function(t){n.getWorkerAudioData(e,{profile:"Jack",language:o,speed:160,pitch:1,rawAudioData:!0},(function(e){s.decodeAudioData(e,(function(a){t(null,[e,a])}))}))})),i.push((function(t){n.getWorkerAudioData(e,{profile:"Jack",language:o,speed:160,pitch:40,rawAudioData:!0},(function(e){s.decodeAudioData(e,(function(a){t(null,[e,a])}))}))})),i.push((function(t){n.getWorkerAudioData(e,{profile:"Roy",language:o,speed:160,pitch:30,rawAudioData:!0},(function(e){s.decodeAudioData(e,(function(a){t(null,[e,a])}))}))})),i.push((function(t){n.getWorkerAudioData(e,{profile:"Roy",language:o,speed:160,pitch:30,rawAudioData:!0},(function(e){s.decodeAudioData(e,(function(a){t(null,[e,a])}))}))})),i.push((function(t){n.getWorkerAudioData(e,{profile:"Leon",language:o,speed:160,pitch:20,rawAudioData:!0},(function(e){s.decodeAudioData(e,(function(a){t(null,[e,a])}))}))})),i.push((function(t){n.getWorkerAudioData(e,{profile:"Xenu",language:o,speed:166,pitch:5,rawAudioData:!0},(function(e){s.decodeAudioData(e,(function(a){t(null,[e,a])}))}))})),c.parallel(i,(function(e,t){if(t){var n=0,i=0,o=0;t.forEach((function(e){var t=e[1];n=Math.max(n,t.length),i=Math.max(i,t.duration),o=t.sampleRate}));var s=f(),r=s.createBuffer(2,o*i,o),l=!1;t.forEach((function(e){var t=e[1];if(l)for(var a=t.getChannelData(0),i=r.getChannelData(0),o=0;o<n;o++)o>i.length&&(i[o]=0),i[o]+=a[o];else for(var s=t.getChannelData(0),u=r.getChannelData(1),c=0;c<n;c++)c>s.length?u[c]=0:u[c]+=s[c];l=!l}));var u=s.createBufferSource();u.buffer=r,a(s,u)}}))}}]),t}(u);g.variants=["f1","f2","f3","f4","f5","m1","m2","m3","m4","m5","m6","m7","croak","klatt","klatt2","klatt3","whisper","whisperf"],g.profiles=p,g.languageIds={ca:"Catalan",cs:"Czech",de:"German",el:"Greek","en/en":"English","en/en-n":"English (N)","en/en-rp":"English (RP)","en/en-sc":"English (Scottish)","en/en-us":"English (US)","en/en-wm":"English (WM)",eo:"Esperanto",es:"Spanish","es-la":"Spanish (Latin America)",fi:"Finnish",fr:"French",hu:"Hungarian",it:"Italian",kn:"Kannada",la:"Latin",lv:"Latvian",nl:"Dutch",pl:"Polish",pt:"Portuguese (Brazil)","pt-pt":"Portuguese, European",ro:"Romanian",sk:"Slovak",sv:"Swedish",tr:"Turkish",zh:"Chinese (Mandarin)","zh-yue":"Chinese (Cantonese)"},g.getLanguageId=function(e){return e.indexOf("_")>-1&&(e=e.replace("_","-")),e.startsWith("en")&&-1===e.indexOf("/")&&(e="en/"+e),e},g.addProfile=function(e){for(var t in e)g.profiles[t]=e[t]},g.setWorkers=function(e){g.workers=e};var m=new h(new g);g.queue=m.queue.bind(m),g.clearQueue=m.clearQueue.bind(m),g.on=m.on.bind(m),g.once=m.once.bind(m),e.exports=g,e.exports.MonauralScope=d},30:function(e,t,a){var n=a(6),i=a(7),o=a(8),s=a(9),r=a(10),l=function(e){"use strict";function t(e){var a;return n(this,t),(a=o(this,s(t).call(this)))._queue=[],a.speaker=e,a}return r(t,e),i(t,[{key:"clearQueue",value:function(){this._queue=[]}},{key:"queue",value:function(e){this._queue.push(e),this._speakNext()}},{key:"_speakNext",value:function(){var e=this;if(!this.isSpeaking){var t=this._queue.shift();t?(this.isSpeaking=!0,this.speaker.getWorkerAudioData(t.text,t.options,(function(a,n){t.onStart&&t.onStart(t),t.scope.loadAudioData(a,n,(function(){t.onStop&&setTimeout((function(){t.onStop(t)}),1),e._onEnded()}))}))):this.emit("finish")}}},{key:"_onEnded",value:function(){this.isSpeaking=!1,this._speakNext()}}]),t}(a(11));e.exports=l},31:function(e,t){e.exports={Jack:{name:"Jack",engine:"espeak",default:{amplitude:100,wordgap:0,pitch:10,speed:180,variant:"m2"},high:{pitch:50},low:{pitch:0},slow:{speed:120},fast:{speed:250}},Pris:{name:"Pris",phoneticName:"Priss",engine:"espeak",default:{amplitude:100,wordgap:0,pitch:47,speed:130,variant:"f5"},high:{pitch:80},low:{pitch:20},slow:{speed:100},fast:{speed:200}},Roy:{name:"Roy",engine:"espeak",default:{amplitude:100,wordgap:0,pitch:35,speed:180,variant:"m1"},high:{pitch:3},low:{pitch:5},slow:{speed:100},fast:{speed:200}},Scotty:{name:"Scotty",engine:"espeak",default:{amplitude:100,wordgap:0,pitch:35,speed:200,variant:"m3"},high:{pitch:3},low:{pitch:5},slow:{speed:100},fast:{speed:230}},Xenu:{name:"Xenu",phoneticName:"zee-new",engine:"espeak",default:{amplitude:100,wordgap:1,pitch:35,speed:170,variant:"klatt3"},high:{pitch:65},low:{pitch:0},slow:{speed:100},fast:{speed:200}},Cylon:{name:"Cylon",engine:"espeak",default:{amplitude:100,wordgap:1,pitch:35,speed:170,variant:"whisperf"},high:{pitch:65,speed:150},low:{pitch:0,speed:140},slow:{pitch:20,speed:100,wordgap:1},fast:{speed:200,wordgap:0}},Leon:{name:"Leon",phoneticName:"Leeon",engine:"espeak",default:{amplitude:100,wordgap:0,pitch:40,speed:150,variant:"m7"},high:{pitch:55},low:{pitch:5},slow:{speed:100},fast:{speed:200}},Rachel:{name:"Rachel",engine:"espeak",default:{amplitude:100,wordgap:0,pitch:60,speed:150,variant:"f2"},high:{pitch:75},low:{pitch:40},slow:{speed:100},fast:{speed:200}},Zhora:{name:"Zhora",engine:"espeak",default:{amplitude:100,wordgap:0,pitch:60,speed:150,variant:"f4"},high:{pitch:75},low:{pitch:40},slow:{speed:100},fast:{speed:200}},Borg:{name:"Borg",engine:"espeak",default:{}},Sam:{name:"Sam",engine:"sam",default:{speed:64,pitch:64,throat:128,mouth:128},high:{pitch:50},low:{pitch:110},slow:{speed:100},fast:{speed:40}},Elf:{name:"Elf",engine:"sam",default:{speed:72,pitch:64,throat:110,mouth:160},high:{pitch:50},low:{pitch:110},slow:{speed:100},fast:{speed:40}},Robo:{name:"Robo",engine:"sam",default:{speed:82,pitch:60,throat:190,mouth:190},high:{pitch:40},low:{pitch:100},slow:{speed:120},fast:{speed:50}},Granny:{name:"Granny",engine:"sam",default:{speed:82,pitch:35,throat:145,mouth:145},high:{pitch:25},low:{pitch:120},slow:{speed:130},fast:{speed:40}}}},32:function(e,t,a){var n=a(6),i=a(7),o=a(8),s=a(9),r=a(13),l=a(10),u=function(e){"use strict";function t(e,a){var i;return n(this,t),a||(a={}),(i=o(this,s(t).call(this))).canvas=e,i.width=i.canvas.width,i.height=i.canvas.height,i.audioContext=null,i.meter=null,i.mediaStreamSource=null,i._draw=i.draw.bind(r(i)),i.isRecording=!1,i.setTheme({lineWidth:a.lineWidth||3,strokeColor:a.strokeColor||"#FF0000",clipColor:a.clipColor||a.strokeColor||"#FF0000",fillColor:a.fillColor||"rgba(255,0,0,0.1)",bgOnColor:a.bgOnColor||null,bgOffColor:a.bgOffColor||null,dotColor:a.dotColor||"#FF0000",dotSize:a.dotSize||3,background:a.background||null}),i}return l(t,e),i(t,[{key:"setTheme",value:function(e){this.theme=e,this.draw()}},{key:"createAudioMeter",value:function(e,t,a,n){var i=e.createScriptProcessor(512);return i.onaudioprocess=function(e){for(var t,a=e.inputBuffer.getChannelData(0),n=a.length,i=0,o=0;o<n;o++)t=a[o],Math.abs(t)>=this.clipLevel&&(this.clipping=!0,this.lastClip=window.performance.now()),i+=t*t;var s=Math.sqrt(i/n);this.volume=Math.max(s,this.volume*this.averaging),this.maxVolume||(this.maxVolume=this.volume),this.maxVolume=Math.max(this.volume,this.maxVolume)},i.clipping=!1,i.lastClip=0,i.volume=0,i.clipLevel=t||.99,i.averaging=a||.97,i.clipLag=n||500,i.connect(e.destination),i.checkClipping=function(){return!!this.clipping&&(this.lastClip+this.clipLag<window.performance.now()&&(this.clipping=!1),this.clipping)},i.shutdown=function(){this.disconnect(),this.onaudioprocess=null},i}},{key:"setIsRecording",value:function(e){this.isRecording!==e?(this.isRecording=e,e?this.startRecording():this.stopRecording()):console.log("same")}},{key:"stopRecording",value:function(){this.isRecording&&(this.mediaStreamSource&&this.meter&&this.mediaStreamSource.disconnect(this.meter),this.meter&&this.meter.shutdown(),this.audioContext&&this.audioContext.close()),this.isRecording=!1,this.isDrawing=!1}},{key:"requestMic",value:function(){var e=this;this.startRecording((function(){e.stopRecording()}),(function(){e.stopRecording()}))}},{key:"startRecording",value:function(e,t){var a=this;if(this.isRecording)console.log("already recording");else{console.log("startRecording"),this.isRecording=!0;var n=new(window.AudioContext||window.webkitAudioContext);this.audioContext=n;var i=function(i){if(console.log("startRecording success"),a.audioContext)try{a.mediaStreamSource=n.createMediaStreamSource(i),a.meter=a.createAudioMeter(n),a.mediaStreamSource.connect(a.meter),a.startDrawing(),e&&e()}catch(o){t&&t()}},o=function(e){console.log("startRecording fail"),t&&t()};try{if(navigator.getUserMedia)navigator.getUserMedia({audio:{mandatory:{googEchoCancellation:"false",googAutoGainControl:"false",googNoiseSuppression:"false",googHighpassFilter:"false"},optional:[]}},i,o);else{if(!navigator.mediaDevices.getUserMedia)throw new Error("no getUserMedia");navigator.mediaDevices.getUserMedia({audio:{mandatory:{googEchoCancellation:"false",googAutoGainControl:"false",googNoiseSuppression:"false",googHighpassFilter:"false"},optional:[]}},i,o)}}catch(s){alert("getUserMedia threw exception :"+s)}}}},{key:"loadAudioData",value:function(e,t,a){var n=this;this.audioContext=e,this.source=t,t.connect(e.destination);var i=this.createAudioMeter(e);this.meter=i,t.connect(this.meter),t.onended=function(){n.isPlaying=!1,t.disconnect(),delete t.buffer,t.stop(),n.stopDrawing(),e.close(),a&&a()},this.isPlaying=!0,this.startDrawing(),t.start(0)}},{key:"startDrawing",value:function(){this.isDrawing=!0,this.draw()}},{key:"stopDrawing",value:function(){this.meter.volume=0,this.draw(),this.isDrawing=!1}},{key:"draw",value:function(){if(this.canvas){var e=this.canvas.getContext("2d");if(this.theme.background?(e.fillStyle=this.theme.background,e.fillRect(0,0,this.width,this.height)):e.clearRect(0,0,this.width,this.height),this.theme.bgOnColor||this.theme.bgOffColor){var t=Math.min(this.width,this.height)/2-e.lineWidth;e.beginPath(),e.arc(this.width/2,this.height/2,t,0,2*Math.PI,!1),e.fillStyle=this.isPlaying||this.isRecording?this.theme.bgOnColor:this.theme.bgOffColor,e.fill(),e.closePath()}if(e.lineWidth=this.theme.lineWidth,this.theme.dotSize){var a=this.theme.dotSize;e.beginPath(),e.arc(this.width/2,this.height/2,a,0,2*Math.PI,!1),e.fillStyle=this.theme.dotColor,e.fill(),e.closePath()}if(this.isRecording||this.isDrawing){if(!this.meter)return void console.error("no meter");e.strokeStyle=this.meter.checkClipping()?this.theme.clipColor:this.theme.strokeColor;var n=Math.min(this.width,this.height)/2-e.lineWidth,i=this.meter.volume*n*5;i>this.width/2-this.theme.lineWidth&&(i=this.width/2-this.theme.lineWidth),e.beginPath(),e.arc(this.width/2,this.height/2,i,0,2*Math.PI,!1),this.theme.fillColor&&(e.fillStyle=this.theme.fillColor,e.fill()),e.stroke(),e.closePath(),this.isDrawing&&window.requestAnimationFrame(this._draw)}else console.log("not drawing")}else console.log("no canvas")}}]),t}(a(11));e.exports=u},34:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),o=a(14),s=a.n(o),r=(a(24),a(15));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(i.a.createElement(r.a,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[19,1,2]]]);
//# sourceMappingURL=main.769c33b0.chunk.js.map